import './polyfills.server.mjs';
import{A as c,Ab as g,D as l,W as f,g as h,q as s,ub as o,x as p,yb as u}from"./chunk-RUC5EUIT.mjs";var m=class n{constructor(e,r){this.http=e;this.platformId=r}apiUrl="https://www.kioscopop.somee.com/api";currentUser=null;login(e,r){let t={email:e,password:r};return this.http.post(`${this.apiUrl}/Auth/login`,t).pipe(p(i=>{this.saveUserData(i),this.getCurrentUser().subscribe(a=>{this.currentUser=a})}),s(this.handleError))}register(e,r,t,i,a){let k={nombre:e,apellido:r,email:t,password:i,rol:a};return this.http.post(`${this.apiUrl}/Auth/register`,k).pipe(s(this.handleError))}logout(){o(this.platformId)&&(localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),localStorage.removeItem("refreshTokenExpiry"))}isAuthenticated(){return o(this.platformId)?!!localStorage.getItem("accessToken"):!1}saveUserData(e){o(this.platformId)&&(localStorage.setItem("accessToken",e.accessToken),localStorage.setItem("refreshToken",e.refreshToken),e.refreshTokenExpiry&&localStorage.setItem("refreshTokenExpiry",e.refreshTokenExpiry.toString()))}refreshToken(e){let r={refreshToken:e};return this.http.post(`${this.apiUrl}/Auth/refresh-token`,r).pipe(p(t=>{this.saveUserData(t)}),s(this.handleError))}isRefreshTokenExpired(){if(o(this.platformId)){let e=localStorage.getItem("refreshTokenExpiry");if(!e)return!0;let r=new Date(e);return new Date>r}return!0}getCurrentUser(){let e={headers:new u({Authorization:`Bearer ${this.getAccessToken()}`})};return this.http.get(`${this.apiUrl}/User/profile`,e).pipe(s(this.handleError))}getAccessToken(){return o(this.platformId)?localStorage.getItem("accessToken"):null}handleError(e){return console.error("Ocurri\xF3 un error:",e),h(()=>new Error("Error en la petici\xF3n HTTP"))}static \u0275fac=function(r){return new(r||n)(l(g),l(f))};static \u0275prov=c({token:n,factory:n.\u0275fac,providedIn:"root"})};export{m as a};
